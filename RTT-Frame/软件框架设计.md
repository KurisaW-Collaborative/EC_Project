# 软件框架设计（线程、任务设计）

---

## 1.定位任务设计

* 数据接收线程(recgps_thread)：从串口读取GPS模块发送来的原始GPS指令，创建一个消息队列(origps_mq)，在接收到串口部分来的原始GPS数据后，将该数据发送到消息队列(origps_mq)中；并创建一个信号量(origps_sem)，并始终在线程的入口函数中始终持有该信号量。

* 数据解析线程(alygps_thread)：等待消息队列(origps_mq)中的消息，一旦消息队列中有消息，就接收该消息并存入数组中，通过nmealib库函数解析为具体的定位信息，将其打包成一个解析数据集（数组），同时创建一个新的消息队列(pldgps_mq)，并将解析的数据集存入到该消息队列中；此时释放一个信号量(origps_sem)，表示此次数据解析完成，同时再次创建一个信号量(pldgps_sem)，并在线程的入口函数中始终持有该信号量。
* 数据上报线程(upldgps_thread)：等待消息队列(pldgps_mq)中的消息，接收来自alygps_thread线程每次读取的GPS解析数据集，此时释放一个信号量(pldgps_sem)，同时将解析数据集发送给云端，并在云端进行数据的解析。

* 阿里云端进行空间数据可视化，添加一个地理位置的定义（可导出运动轨迹）。

## 2.图传任务设计（原路径规划设计）

* 图像采集线程(capimg_thread)：通过摄像头进行路况数据的图像帧采集，创建一个消息队列(orimg_mq)，将帧数据存入消息队列中。同时创建一个互斥量(orimg_mux)，在线程的入口函数中始终持有该互斥量。
* 图像压缩线程(cmpresimg_thread)：等待来自图像采集线程中消息队列(orimg_mq)，收到消息后将数据从消息队列中读取出来，同时压缩图像数据为jpeg格式，创建一个信号量(cmpresimg_sem)，将压缩数据通过串口发送给4G模块后启动线程的入口函数，并且在线程入口函数中始终持有该信号量。
* 图像解析线程(alyimg_thread)：4G模块接收到图像数据后，通过移动网络将数据上传到云端或者其他设备上，实现远程监控和控制功能

附：此处可能不参与系统设计，考虑使用单向视频网络传输技术（WebRTC）实现
